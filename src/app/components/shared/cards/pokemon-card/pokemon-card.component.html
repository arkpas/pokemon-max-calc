<div
  class="pokemon-card"
  [ngClass]="{ 'single-type': !candidate.secondaryType, 'dual-type': !!candidate.secondaryType }"
  [ngStyle]="{
    '--primary-type-color': getTypeColor(candidate.primaryType),
    '--secondary-type-color': getTypeColor(candidate.secondaryType),
  }">
  <div class="header-inline">
    <img
      class="sprite"
      [src]="'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/' + candidate.pokedexNumber + '.png'"
      alt="sprite" />
      <div class="name">
        <span class="{{ candidate.myPokemonId ? 'my-pokemon' : '' }}">{{ candidate.name }}</span>
      </div>

      @if (candidate.cpm) {
        <div class="stats">
          <div class="stat-row">
            @if (pokemonCardType === PokemonCardTypeEnum.Attacker && candidate.maxPhaseDamageDetails.length) {
              <div class="stat" title="Max Type)">
                <div class="{{ candidate.maxPhaseDamageDetails[0].move.special.toLowerCase() }} type-bg">
                  {{ candidate.maxPhaseDamageDetails[0].move.special }}
                </div>
              </div>
            }
            <div class="stat" title="Poziom">
              â­
              <strong>L{{ candidate.cpm | cpmToLevel }}</strong>
            </div>
            <div
              class="stat"
              matTooltip="IV: {{ candidate.atkIV }}/{{ candidate.defIV }}/{{ candidate.hpIV }}"
              matTooltipPosition="above"
              #tooltip="matTooltip"
              (click)="tooltip.toggle()">
              ğŸ’
              <strong
                ><u>{{ candidate.atkIV + candidate.defIV + candidate.hpIV | ivPercentage }}%</u></strong
                >
              </div>
            </div>
            <div class="stat-row">
              @if (pokemonCardType === PokemonCardTypeEnum.Attacker && candidate.maxPhaseDamageDetails.length) {
                <div class="stat" title="ObraÅ¼enia)">
                  ğŸ’¥
                  <strong>{{ candidate.maxPhaseDamageDetails[0].damage }}</strong>
                </div>
              }
              @if (pokemonCardType === PokemonCardTypeEnum.Tank) {
                <div class="stat" title="Åšrednie obraÅ¼enia (bazowe + procentowe)">
                  ğŸ’¥
                  <strong>{{ candidate.avgDamageTaken.toFixed(1) }} ({{ candidate.avgDamageTakenPercentage.toFixed(1) }}%)</strong>
                </div>
              }
              @if (pokemonCardType === PokemonCardTypeEnum.Healer) {
                <div class="stat" title="Leczenie (3x Max Heal)">
                  ğŸ©¹ <strong>{{ candidate.heal.toFixed(0) }}</strong>
                </div>
              }
              @if (pokemonCardType === PokemonCardTypeEnum.Healer) {
                <div
                  class="stat"
                  title="Ile procentowo obraÅ¼eÅ„ nie bÄ™dzie w stanie wyleczyÄ‡ przeciwko wszystkim atakom bossa">
                  ğŸ©¸ <strong>{{ candidate.totalUnhealedDamagePercentage.toFixed(2) }}</strong>
                </div>
              }
              <div class="stat atk" title="Atak fizyczny (ATK)">
                âš”ï¸ <strong>{{ candidate.atk.toFixed(0) }}</strong>
              </div>
              <div class="stat def" title="Obrona fizyczna (DEF)">
                ğŸ›¡ï¸ <strong>{{ candidate.def.toFixed(0) }}</strong>
              </div>
              <div class="stat hp" title="Punkty Å¼ycia (HP)">
                â¤ï¸ <strong>{{ candidate.hp }}</strong>
              </div>
            </div>
          </div>
        }
        <div class="actions">
          @if (candidate.damageTakenDetails && candidate.damageTakenDetails.length !== 0) {
            <div class="action">
              <button (click)="toggleDetails()" class="icon-button" title="PokaÅ¼/ukryj szczegÃ³Å‚y obraÅ¼eÅ„">
                {{ showDetails ? 'ğŸš«' : 'ğŸ‘ï¸' }}
              </button>
            </div>
          }
        </div>
      </div>

      @if (showDetails) {
        <div class="damage-details">
          @if (pokemonCardType === PokemonCardTypeEnum.Attacker) {
            <div class="damage-details-section">
              <span class="damage-details-section-name">ğŸ‘¾ Max Phase Damage</span>
              <div class="damage-details-table-wrapper">
                <table class="damage-details-table">
                  @for (entry of candidate.maxPhaseDamageDetails; track entry) {
                    <tr>
                      <td>
                        <div class="type-bg {{ entry.move.type.toLowerCase() }}">
                          {{ entry.move.name }} @if (entry.move.special === 'elite') {
                          <span class="sup">E</span>
                        }
                      </div>
                    </td>
                    <td title="Damage">ğŸ’¥ {{ entry.damage.toFixed(0) }}</td>
                    <td title="Power">ğŸ’ª {{ entry.move.power }}</td>
                    <td
                      matTooltip="ğŸ¯ {{ (entry.damageModifiers.typeEffectiveness * 100).toFixed(1) }}% ğŸ§¬ {{ entry.damageModifiers.stab }}"
                      matTooltipPosition="above"
                      #tooltip="matTooltip"
                      (click)="tooltip.toggle()">
                      ğŸ”
                    </td>
                    <td></td>
                  </tr>
                }
              </table>
            </div>
          </div>
        }
        <div class="damage-details-section">
          <span class="damage-details-section-name">âš”ï¸ Fast Attacks</span>
          <div class="damage-details-table-wrapper">
            <table class="damage-details-table">
              @for (entry of candidate.fastAttackDamageDetails; track entry) {
                <tr>
                  <td>
                    <div class="type-bg {{ entry.move.type.toLowerCase() }}">
                      {{ entry.move.name }} @if (entry.move.special === 'elite') {
                      <span class="sup">E</span>
                    }
                  </div>
                </td>
                <td title="Damage">ğŸ’¥ {{ entry.damage.toFixed(0) }}</td>
                <td title="Move duration" [ngStyle]="{ color: getFastAttackDurationColor(entry.move.duration) }">â±ï¸ {{ entry.move.duration }}s</td>
                <td title="Max Energy">ğŸŒ€ {{ entry.maxEnergy }}</td>
                <td title="Power">ğŸ’ª {{ entry.move.power }}</td>
                <td
                  matTooltip="ğŸ¯ {{ (entry.damageModifiers.typeEffectiveness * 100).toFixed(1) }}% ğŸ§¬ {{ entry.damageModifiers.stab }}"
                  matTooltipPosition="above"
                  #tooltip="matTooltip"
                  (click)="tooltip.toggle()">
                  ğŸ”
                </td>
                <td></td>
              </tr>
            }
          </table>
        </div>
      </div>
      @if (pokemonCardType !== PokemonCardTypeEnum.Attacker) {
        <div class="damage-details-section">
          <span class="damage-details-section-name">ğŸ›¡ï¸ Damage taken</span>
          <div class="damage-details-table-wrapper">
            <table class="damage-details-table">
              @for (entry of candidate.damageTakenDetails; track entry) {
                <tr>
                  <td>
                    <div class="type-bg {{ entry.move.type.toLowerCase() }}">
                      {{ entry.move.name }}
                    </div>
                  </td>
                  <td title="Damage">
                    <span [ngStyle]="{ color: getDamagePercentageColor(entry.damagePercentage) }">
                      ğŸ’¥ {{ entry.damage.toFixed(0) }} ({{ entry.damagePercentage.toFixed(1) }}%)
                    </span>
                  </td>
                  <td title="Power">ğŸ’ª {{ entry.move.power }}</td>
                  <td
                    matTooltip="ğŸ¯ {{ (entry.damageModifiers.typeEffectiveness * 100).toFixed(1) }}% ğŸ§¬ {{ entry.damageModifiers.stab }}"
                    matTooltipPosition="above"
                    #tooltip="matTooltip"
                    (click)="tooltip.toggle()">
                    ğŸ”
                  </td>
                  <td></td>
                </tr>
              }
            </table>
          </div>
        </div>
      }
      <!-- TODO: this is bloating the screen too much, need to think of another way of displaying it -->
      <!-- <div class="damage-details-section">
      <span class="damage-details-section-name">ğŸ’£ Charged Attacks</span>
      <div class="damage-details-table-wrapper">
        <table class="damage-details-table">
          <tr *ngFor="let entry of candidate.chargedAttackDamageDetails">
            <td>
              <div class="type-bg {{ entry.move.type.toLowerCase() }}">
                {{ entry.move.name }} <span class="sup" *ngIf="entry.move.special === 'elite'">E</span>
              </div>
            </td>
            <td title="Damage">ğŸ’¥ {{ entry.damage.toFixed(0) }}</td>
            <td title="Move duration">â±ï¸ {{ entry.move.duration }}s</td>
            <td title="Max Energy">ğŸŒ€ {{ entry.maxEnergy }}</td>
            <td title="Power">ğŸ’ª {{ entry.move.power }}</td>
            <td
              matTooltip="ğŸ¯ {{ (entry.damageModifiers.typeEffectiveness * 100).toFixed(1) }}% ğŸ§¬ {{ entry.damageModifiers.stab }}"
              matTooltipPosition="above"
              #tooltip="matTooltip"
              (click)="tooltip.toggle()">
              ğŸ”
            </td>
            <td></td>
          </tr>
        </table>
      </div>
    </div> -->
  </div>
}
</div>
