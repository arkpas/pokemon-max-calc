<div
  class="pokemon-card"
  [ngClass]="{ 'single-type': !candidate.secondaryType, 'dual-type': !!candidate.secondaryType }"
  [ngStyle]="{
    '--primary-type-color': getTypeColor(candidate.primaryType),
    '--secondary-type-color': getTypeColor(candidate.secondaryType),
  }">
  <div class="header-inline">
    <img
      class="sprite"
      [src]="'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/' + candidate.pokedexNumber + '.png'"
      alt="sprite" />
    <div class="name">
      <span class="{{ candidate.myPokemonId ? 'my-pokemon' : '' }}">{{ candidate.name }}</span>
    </div>

    <div *ngIf="candidate.cpm" class="stats">
      <div class="stat-row">
        <div *ngIf="pokemonCardType === PokemonCardTypeEnum.Attacker && candidate.maxPhaseDamageDetails.length" class="stat" title="Max Type)">
          <div class="{{ candidate.maxPhaseDamageDetails[0].move.special.toLowerCase() }} type-bg">
            {{ candidate.maxPhaseDamageDetails[0].move.special }}
          </div>
        </div>
        <div class="stat" title="Poziom">
          â­
          <strong>L{{ candidate.cpm | cpmToLevel }}</strong>
        </div>
        <!-- eslint-disable @angular-eslint/template/click-events-have-key-events, @angular-eslint/template/interactive-supports-focus -->
        <div
          class="stat"
          matTooltip="IV: {{ candidate.atkIV }}/{{ candidate.defIV }}/{{ candidate.hpIV }}"
          matTooltipPosition="above"
          #tooltip="matTooltip"
          (click)="tooltip.toggle()">
          ğŸ’
          <strong
            ><u>{{ candidate.atkIV + candidate.defIV + candidate.hpIV | ivPercentage }}%</u></strong
          >
        </div>
        <!-- eslint-enable @angular-eslint/template/click-events-have-key-events, @angular-eslint/template/interactive-supports-focus -->
      </div>
      <div class="stat-row">
        <div *ngIf="pokemonCardType === PokemonCardTypeEnum.Attacker && candidate.maxPhaseDamageDetails.length" class="stat" title="ObraÅ¼enia)">
          ğŸ’¥
          <strong>{{ candidate.maxPhaseDamageDetails[0].damage }}</strong>
        </div>

        <div *ngIf="pokemonCardType === PokemonCardTypeEnum.Tank" class="stat" title="Åšrednie obraÅ¼enia (bazowe + procentowe)">
          ğŸ’¥
          <strong>{{ candidate.avgDamageTaken.toFixed(1) }} ({{ candidate.avgDamageTakenPercentage.toFixed(1) }}%)</strong>
        </div>

        <div *ngIf="pokemonCardType === PokemonCardTypeEnum.Healer" class="stat" title="Leczenie (3x Max Heal)">
          ğŸ©¹ <strong>{{ candidate.heal.toFixed(0) }}</strong>
        </div>

        <div
          *ngIf="pokemonCardType === PokemonCardTypeEnum.Healer"
          class="stat"
          title="Ile procentowo obraÅ¼eÅ„ nie bÄ™dzie w stanie wyleczyÄ‡ przeciwko wszystkim atakom bossa">
          ğŸ©¸ <strong>{{ candidate.totalUnhealedDamagePercentage.toFixed(2) }}</strong>
        </div>

        <div class="stat atk" title="Atak fizyczny (ATK)">
          âš”ï¸ <strong>{{ candidate.atk.toFixed(0) }}</strong>
        </div>

        <div class="stat def" title="Obrona fizyczna (DEF)">
          ğŸ›¡ï¸ <strong>{{ candidate.def.toFixed(0) }}</strong>
        </div>

        <div class="stat hp" title="Punkty Å¼ycia (HP)">
          â¤ï¸ <strong>{{ candidate.hp }}</strong>
        </div>
      </div>
    </div>
    <div class="actions">
      <div class="action" *ngIf="isMyPokemonActionsEnabled && candidate.myPokemonId">
        <button (click)="removeMyPokemon()" class="icon-button" title="UsuÅ„ swojego Pokemona">ğŸ—‘ï¸</button>
      </div>
      <div class="action" *ngIf="candidate.damageTakenDetails && candidate.damageTakenDetails.length !== 0">
        <button (click)="toggleDetails()" class="icon-button" title="PokaÅ¼/ukryj szczegÃ³Å‚y obraÅ¼eÅ„">
          {{ showDetails ? 'ğŸš«' : 'ğŸ‘ï¸' }}
        </button>
      </div>
    </div>
  </div>

  <div class="damage-section" *ngIf="showDetails">
    <div class="damage-list" *ngIf="pokemonCardType === PokemonCardTypeEnum.Attacker">
      <span class="damage-list-name">ğŸ‘¾ Max Phase Damage</span>
      <details *ngFor="let entry of candidate.maxPhaseDamageDetails" class="damage-row">
        <summary class="damage-summary offensive">
          <span class="col attack-name type-bg {{ entry.move.type.toLowerCase() }}">
            {{ entry.move.name }} <span class="sup" *ngIf="entry.move.special === 'elite'">E</span>
          </span>
          <span class="col damage-stats"
            >ğŸ’¥ <strong>{{ entry.damage.toFixed(0) }} </strong></span
          >

          <span class="col power"
            >ğŸ’ª <strong>{{ entry.move.power }}</strong></span
          >
          <span class="col duration">â±ï¸ {{ entry.move.duration }}s </span>
          <span class="col typeEffectiveness">ğŸ¯ {{ (entry.damageModifiers.typeEffectiveness * 100).toFixed(1) }}% </span>
          <span class="col stab">ğŸ§¬ {{ entry.damageModifiers.stab }}</span>
        </summary>
      </details>
    </div>
    <div class="damage-list" *ngIf="pokemonCardType !== PokemonCardTypeEnum.Attacker">
      <span class="damage-list-name">ğŸ›¡ï¸ Damage taken</span>
      <details *ngFor="let entry of candidate.damageTakenDetails" class="damage-row">
        <summary class="damage-summary">
          <span class="col attack-name type-bg {{ entry.move.type.toLowerCase() }}">
            {{ entry.move.name }}
          </span>
          <span
            class="col damage-stats"
            [ngStyle]="{
              color: getDamagePercentageColor(entry.damagePercentage),
            }"
            >ğŸ’¥ {{ entry.damage.toFixed(0) }} (<strong>{{ entry.damagePercentage.toFixed(1) }}%</strong>)</span
          >
          <span class="col power"
            >ğŸ’ª <strong>{{ entry.move.power }}</strong></span
          >
          <span class="col typeEffectiveness">ğŸ¯ {{ (entry.damageModifiers.typeEffectiveness * 100).toFixed(1) }}% </span>
          <span class="col stab">ğŸ§¬ {{ entry.damageModifiers.stab }}</span>
        </summary>
      </details>
    </div>
    <div class="damage-list">
      <span class="damage-list-name">âš”ï¸ Fast Attacks</span>

      <details *ngFor="let entry of candidate.fastAttackDamageDetails" class="damage-row">
        <summary class="damage-summary offensive">
          <span class="col attack-name type-bg {{ entry.move.type.toLowerCase() }}">
            {{ entry.move.name }} <span class="sup" *ngIf="entry.move.special === 'elite'">E</span>
          </span>
          <span class="col damage-stats"
            >ğŸ’¥ <strong>{{ entry.damage.toFixed(0) }} </strong></span
          >

          <span class="col power"
            >ğŸ’ª <strong>{{ entry.move.power }}</strong></span
          >
          <span class="col duration">â±ï¸ {{ entry.move.duration }}s </span>
          <span class="col typeEffectiveness">ğŸ¯ {{ (entry.damageModifiers.typeEffectiveness * 100).toFixed(1) }}% </span>
          <span class="col stab">ğŸ§¬ {{ entry.damageModifiers.stab }}</span>
        </summary>
      </details>
    </div>
  </div>
</div>
