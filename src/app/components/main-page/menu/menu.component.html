<div [ngClass]="isCollapsed ? 'menu menu-collapsed' : 'menu'">
  @if (isCollapsed) {
  <div class="menu-button">
    <button (click)="showForm()">â˜°</button>
  </div>
  }

  <form [formGroup]="battleConfigurationForm" (ngSubmit)="submit()">
    <div class="top-row">
      <div class="title">
        <span>Max Calculator</span>
      </div>
    </div>

    <div>
      <mat-form-field appearance="outline">
        <mat-label>Select opponent</mat-label>
        <mtx-select [items]="pokemonOptions" [required]="true"
          [formControl]="battleConfigurationForm.controls.opponentName"
          (change)="preconfigureOpponent($event)"></mtx-select>
        <mat-error>Please provide valid Pokemon name!</mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>General config</mat-label>
        <mat-select #generalConfigSelect matNativeControl required (selectionChange)="changeGeneralConfig($event)">
          @for (generalConfig of generalConfigs; track generalConfig) {
          <mat-option [value]="generalConfig.opponentName">{{ generalConfig.opponentName }} <small>{{
              generalConfig.opponentCpm !== 0 ? ' | ' + generalConfig.opponentCpm + ' CPM' : '' }}</small>
          </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Date of max battle</mat-label>
        <input matInput [matDatepicker]="picker" [formControl]="battleConfigurationForm.controls.date" />
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        @if (battleConfigurationForm.controls.date.invalid) {
        <mat-error> Please provide valid date! </mat-error>
        }
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Pokemon LVL</mat-label>
        <mtx-select [required]="true" [formControl]="battleConfigurationForm.controls.allyCpm">
          @for (pokemonCpm of pokemonCpms; track pokemonCpm) {
          <mtx-option [value]="pokemonCpm.value">
            {{ pokemonCpm.level }} LVL | <small>{{ pokemonCpm.value}} CPM</small>
          </mtx-option>
          }
        </mtx-select>
        <mat-error>Please provide valid Pokemon LVL!</mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Team option</mat-label>
        <mat-select [formControl]="battleConfigurationForm.controls.teamOption">
          @for (option of teamOptions; track option) {
          <mat-option [value]="option">
            {{ option }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <mat-expansion-panel #opponentAdvancedPanel>
      <mat-expansion-panel-header>
        <mat-panel-title> Opponent - Advanced options </mat-panel-title>
      </mat-expansion-panel-header>

      <div>
        <mat-form-field appearance="outline">
          <mat-label>CPM</mat-label>
          <input matInput type="number" [formControl]="battleConfigurationForm.controls.opponentCpm"
            (focus)="this.selectAll($event)" />
          @if (battleConfigurationForm.controls.opponentCpm.invalid) {
          <mat-error> Please provide valid CPM value! </mat-error>
          }
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline">
          <mat-label>HP</mat-label>
          <input matInput type="number" [formControl]="battleConfigurationForm.controls.opponentHp"
            (focus)="this.selectAll($event)" />
          @if (battleConfigurationForm.controls.opponentHp.invalid) {
          <mat-error> Please provide valid HP value! </mat-error>
          }
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline">
          <mat-label>Attack modificator</mat-label>
          <input matInput placeholder="Attack modificator" id="atkMod" type="number"
            [formControl]="battleConfigurationForm.controls.opponentAtkMod" (focus)="this.selectAll($event)" />
          @if (battleConfigurationForm.controls.opponentAtkMod.invalid) {
          <mat-error> Please provide valid attack modificator value! </mat-error>
          }
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline">
          <mat-label>Defense modificator</mat-label>
          <input matInput placeholder="Defense modificator" id="defMod" type="number"
            [formControl]="battleConfigurationForm.controls.opponentDefMod" (focus)="this.selectAll($event)" />
          @if (battleConfigurationForm.controls.opponentDefMod.invalid) {
          <mat-error> Please provide valid defense modificator value! </mat-error>
          }
        </mat-form-field>
      </div>
    </mat-expansion-panel>
    <mat-expansion-panel #otherOptionsPanel>
      <mat-expansion-panel-header>
        <mat-panel-title> Other options</mat-panel-title>
      </mat-expansion-panel-header>
      <div>
        <mat-form-field appearance="outline">
          <mat-label>Weather</mat-label>
          <mat-select [required]="true" [formControl]="battleConfigurationForm.controls.weather">
            <mat-select-trigger>{{ battleConfigurationForm.controls.weather.value }}</mat-select-trigger>
            @for (weather of weathers; track weather.name) {
            <mat-option [value]="weather.name">
              {{ weather.name }} @if (weather.boostedTypes.length) {
              | <small><i>{{ weather.boostedTypes.join(", ") }}</i></small>
              }
            </mat-option>
            }
          </mat-select>
          <mat-error>Please provide valid weather!</mat-error>
        </mat-form-field>
      </div>

      <div>
        <mat-form-field appearance="outline">
          <mat-label>Friendship</mat-label>
          <mat-select [required]="true" [formControl]="battleConfigurationForm.controls.friendship">
            <mat-select-trigger>{{ battleConfigurationForm.controls.friendship.value }}</mat-select-trigger>
            @for (friendship of friendships; track friendship.name) {
            <mat-option [value]="friendship.name">
              {{ friendship.name }} | <small><i>x{{ friendship.modifier.toFixed(2) }}</i></small>
            </mat-option>
            }
          </mat-select>
          <mat-error>Please provide valid friendship level!</mat-error>
        </mat-form-field>
      </div>
    </mat-expansion-panel>

    <div class="form-buttons">
      <button mat-flat-button type="submit">Calculate</button>
      <button mat-stroked-button type="button" (click)="navigateToMyPokemon()">My Pokemon</button>
    </div>
  </form>
</div>