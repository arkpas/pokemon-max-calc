<div [ngClass]="isCollapsed ? 'menu menu-collapsed' : 'menu'">
  <div *ngIf="isCollapsed" class="menu-button">
    <button (click)="showForm()">â˜°</button>
  </div>

  <form [formGroup]="battleConfigurationForm" (ngSubmit)="submit()">
    <div class="top-row">
      <div class="title">
        <span>Max Calculator</span>
      </div>
    </div>

    <div>
      <mat-form-field appearance="outline" (click)="this.battleConfigurationForm.controls.opponentName.setValue(null)">
        <mat-label>Boss</mat-label>
        <input
          placeholder="Select opponent"
          matInput
          [formControl]="battleConfigurationForm.controls.opponentName"
          [matAutocomplete]="raidBossAuto" />
        <mat-autocomplete #raidBossAuto="matAutocomplete" (optionSelected)="preconfigureOpponent($event)">
          @for (option of filteredPokemonOptions | async; track option) {
            <mat-option [value]="option">{{ option }}</mat-option>
          }
        </mat-autocomplete>
        <mat-error *ngIf="battleConfigurationForm.controls.opponentName.invalid"> Please provide valid Pokemon name! </mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>General config</mat-label>
        <mat-select #generalConfigSelect matNativeControl required (selectionChange)="changeGeneralConfig($event)">
          @for (generalConfig of generalConfigs; track generalConfig) {
            <mat-option [value]="generalConfig.opponentName"
              >{{ generalConfig.opponentName }} <small>{{ generalConfig.opponentCpm !== 0 ? ' | ' + generalConfig.opponentCpm + ' CPM' : '' }}</small>
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Date of max battle</mat-label>
        <input matInput [matDatepicker]="picker" [formControl]="battleConfigurationForm.controls.date" />
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="battleConfigurationForm.controls.date.invalid"> Please provide valid date! </mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Pokemon LVL</mat-label>
        <input
          matInput
          [matAutocomplete]="pokemonCpmAuto"
          [formControl]="battleConfigurationForm.controls.allyCpm"
          (focus)="this.selectAll($event)" />
        <mat-autocomplete #pokemonCpmAuto="matAutocomplete">
          @for (pokemonCpm of filteredPokemonCpms | async; track pokemonCpm.description) {
            <mat-option [value]="pokemonCpm.value">
              <span>{{ pokemonCpm.value }}</span> |
              <small>{{ pokemonCpm.description }}</small>
            </mat-option>
          }
        </mat-autocomplete>
        <mat-error *ngIf="battleConfigurationForm.controls.allyCpm.invalid"> Please provide valid CPM value! </mat-error>
      </mat-form-field>
    </div>
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Team option</mat-label>
        <mat-select [formControl]="battleConfigurationForm.controls.teamOption">
          <mat-option *ngFor="let option of teamOptions" [value]="option">
            {{ option }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <mat-expansion-panel #advancedPanel>
      <mat-expansion-panel-header>
        <mat-panel-title> Advanced </mat-panel-title>
      </mat-expansion-panel-header>

      <div>
        <mat-form-field appearance="outline">
          <mat-label>CPM</mat-label>
          <input matInput type="number" [formControl]="battleConfigurationForm.controls.opponentCpm" (focus)="this.selectAll($event)" />
          <mat-error *ngIf="battleConfigurationForm.controls.opponentCpm.invalid"> Please provide valid CPM value! </mat-error>
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline">
          <mat-label>HP</mat-label>
          <input matInput type="number" [formControl]="battleConfigurationForm.controls.opponentHp" (focus)="this.selectAll($event)" />
          <mat-error *ngIf="battleConfigurationForm.controls.opponentHp.invalid"> Please provide valid HP value! </mat-error>
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline">
          <mat-label>Attack modificator</mat-label>
          <input
            matInput
            placeholder="Attack modificator"
            id="atkMod"
            type="number"
            [formControl]="battleConfigurationForm.controls.opponentAtkMod"
            (focus)="this.selectAll($event)" />
          <mat-error *ngIf="battleConfigurationForm.controls.opponentAtkMod.invalid"> Please provide valid attack modificator value! </mat-error>
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline">
          <mat-label>Defense modificator</mat-label>
          <input
            matInput
            placeholder="Defense modificator"
            id="defMod"
            type="number"
            [formControl]="battleConfigurationForm.controls.opponentDefMod"
            (focus)="this.selectAll($event)" />
          <mat-error *ngIf="battleConfigurationForm.controls.opponentDefMod.invalid"> Please provide valid defense modificator value! </mat-error>
        </mat-form-field>
      </div>
    </mat-expansion-panel>
    <div class="form-buttons">
      <button mat-flat-button type="submit">Calculate</button>
      <button mat-stroked-button type="button" (click)="navigateToMyPokemon()">My Pokemon</button>
    </div>
  </form>
</div>
